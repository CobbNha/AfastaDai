<!doctype html>
<html lang="pt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Afasta DaÃ­ â€” Nome na Lista</title>
  <style>
    :root{--bg:#f6f8fb;--card:#ffffff;--accent:#2563eb;--muted:#6b7280;--text:#111827;--black:#000000}
    body{font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial;background:var(--bg);margin:0;padding:24px;color:var(--text)}
    .container{max-width:980px;margin:0 auto;padding-bottom:60px}
    .card{background:var(--card);border-radius:12px;box-shadow:0 6px 18px rgba(15,23,42,0.06);padding:18px;margin-bottom:16px}
    h1{margin:0 0 8px;font-size:22px;color:var(--black);text-align:center}
    label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
    input,select,textarea{width:100%;padding:10px;border:1px solid #e6e9ef;border-radius:8px;font-size:14px}
    textarea{resize:vertical;min-height:68px}
    button{background:var(--accent);color:white;border:0;padding:10px 12px;border-radius:8px;cursor:pointer;transition:all .2s}
    button:hover{opacity:.9}
    button.ghost{background:transparent;color:var(--accent);border:1px solid #dbe6ff}
    .hidden{display:none}
    .msg{background:#e0ffe4;color:#065f46;border:1px solid #baf2c0;border-radius:8px;padding:10px;margin-top:12px;text-align:center}
    #whatsappBtn{background:#25d366;margin-top:8px}
    footer{position:fixed;bottom:0;left:0;width:100%;background:var(--accent);color:white;text-align:center;padding:14px 0;font-weight:500;font-size:15px;cursor:pointer;transition:background .2s}
    footer:hover{background:#1d4ed8}
  </style>
</head>
<body>
  <div class="container">
    <div class="card" id="loginCard">
    
 
      <input id="adminCode" type="password" placeholder="" />
      <button id="enterAdmin">Preenche ðŸ‘‡</button>
    </div>

    <div class="card" id="formCard">
      <h1>Preenche o FormulÃ¡rio â€” Evento Matola, Paragem farmÃ¡cia da Witbank</h1>
      <form id="personForm">
        <label>Nome</label>
        <input id="name" required placeholder="Ex: Ghost Fried'S" />
        <label>GÃ©nero</label>
        <select id="gender">
          <option value="M">Masculino</option>
          <option value="F">Feminino</option>
          <option value="O">Outro</option>
        </select>
        <label>NÃºmero</label>
        <input id="phone" required placeholder="Ex: 867716179" />
        <label>Morada</label>
        <textarea id="address" placeholder="Rua, bairro, cidade..."></textarea>
        <button type="submit">Enviar</button>
      </form>
      <div id="successMsg" class="msg hidden"></div>
      <button id="whatsappBtn" class="hidden">Enviar confirmaÃ§Ã£o pelo WhatsApp</button>
    </div>

    <div class="card hidden" id="adminPanel">
      <h1>Painel do Administrador</h1>
      <div style="margin-bottom:12px;display:flex;gap:8px;flex-wrap:wrap">
        <button id="exportExcel">Exportar Excel</button>
        <button id="exportPDF" class="ghost">Exportar PDF</button>
        <button id="clearList" class="ghost">Limpar Lista</button>
      </div>
      <table id="peopleTable" style="width:100%;border-collapse:collapse">
        <thead><tr><th>Nome</th><th>GÃ©nero</th><th>Telefone</th><th>Morada</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <footer id="contactOrganizer">ðŸ’¬ Falar com o organizador no WhatsApp</footer>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <script>
    const ADMIN_PASSWORD = '20252025';

    const firebaseConfig = {
      apiKey: "AIzaSyBE_jjuFipcMX6OJt4LjsS7keBBy-q3wNI",
      authDomain: "afastadai-evento.firebaseapp.com",
      projectId: "afastadai-evento",
      storageBucket: "afastadai-evento.firebasestorage.app",
      messagingSenderId: "1096291680045",
      appId: "1:1096291680045:web:b401886adc094486d41da4",
      databaseURL: "https://afastadai-evento-default-rtdb.europe-west1.firebasedatabase.app/"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const people = JSON.parse(localStorage.getItem('peopleList') || '[]');

    const loginCard = document.getElementById('loginCard');
    const adminPanel = document.getElementById('adminPanel');
    const formCard = document.getElementById('formCard');
    const form = document.getElementById('personForm');
    const successMsg = document.getElementById('successMsg');
    const whatsappBtn = document.getElementById('whatsappBtn');

    document.getElementById('enterAdmin').addEventListener('click', ()=>{
      const code = document.getElementById('adminCode').value.trim();
      if(code === ADMIN_PASSWORD){
        loginCard.classList.add('hidden');
        adminPanel.classList.remove('hidden');
        renderList();
        listenRealtime();
      } else {
        alert('Ignore esse campo!');
      }
    });

    form.addEventListener('submit', e=>{
      e.preventDefault();
      const p = {
        name: document.getElementById('name').value.trim(),
        gender: document.getElementById('gender').value,
        phone: document.getElementById('phone').value.trim(),
        address: document.getElementById('address').value.trim()
      };
      if(!p.name || !p.phone) return alert('Preencha nome e nÃºmero.');

      const newRef = db.ref('registos').push();
      newRef.set(p).catch(()=>console.warn('Falha no Firebase, a guardar local.'));
      people.push(p);
      localStorage.setItem('peopleList', JSON.stringify(people));

      successMsg.textContent = 'Nome na lista enviado com sucesso e atÃ© o dia do evento, nÃ£o esqueÃ§a do local: Matola Witbank, Paragem FarmÃ¡cia, na Rua da Padaria.';
      successMsg.classList.remove('hidden');
      whatsappBtn.classList.remove('hidden');

      const mensagem = encodeURIComponent(`ðŸ‘‹ OlÃ¡! Acabei de me inscrever no evento Afasta DaÃ­.%0Aâ€¢ Nome: ${p.name}%0Aâ€¢ NÃºmero: ${p.phone}%0Aâ€¢ Morada: ${p.address}`);
      const link = `https://wa.me/258867716179?text=${mensagem}`;

      whatsappBtn.onclick = ()=>window.open(link, '_blank');

      form.reset();
      setTimeout(()=>{
        successMsg.classList.add('hidden');
        whatsappBtn.classList.add('hidden');
      },30000); // 30 segundos
    });

    function renderList(data){
      const tbody = document.querySelector('#peopleTable tbody');
      tbody.innerHTML = '';
      const list = data || people;
      list.forEach(p=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${p.name}</td><td>${p.gender}</td><td>${p.phone}</td><td>${p.address}</td>`;
        tbody.appendChild(tr);
      });
    }

    function listenRealtime(){
      db.ref('registos').on('value', snapshot => {
        const data = snapshot.val() || {};
        const arr = Object.values(data);
        renderList(arr);
      });
    }

    document.getElementById('clearList').addEventListener('click',()=>{
      if(confirm('Apagar todos os registos?')){
        db.ref('registos').remove();
        people.length = 0;
        localStorage.removeItem('peopleList');
        renderList();
      }
    });

    document.getElementById('exportExcel').addEventListener('click',()=>{
      db.ref('registos').once('value').then(snapshot=>{
        const data = Object.values(snapshot.val() || {});
        if(!data.length) return alert('Sem registos');
        const ws = XLSX.utils.json_to_sheet(data);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, 'Registos');
        XLSX.writeFile(wb, 'registos.xlsx');
      });
    });

    document.getElementById('exportPDF').addEventListener('click', async ()=>{
      const table = document.getElementById('peopleTable');
      const canvas = await html2canvas(table);
      const imgData = canvas.toDataURL('image/png');
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF('p','pt','a4');
      const w = pdf.internal.pageSize.getWidth();
      const h = canvas.height * w / canvas.width;
      pdf.addImage(imgData,'PNG',0,0,w,h);
      pdf.save('registos.pdf');
    });

    // RodapÃ© â€” contato WhatsApp
    document.getElementById('contactOrganizer').addEventListener('click', ()=>{
      window.open('https://wa.me/258867716179?text=OlÃ¡! Gostaria de mais informaÃ§Ãµes sobre o evento Afasta DaÃ­.', '_blank');
    });
  </script>
</body>
</html>






